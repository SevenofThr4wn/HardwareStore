@model List<HardwareStore.WebClient.ViewModels.Account.UserManageVM>
@{
    ViewData["Title"] = "Manage Users";
    Layout = "_Layout";
}

<div class="max-w-[1400px] mx-auto p-6">
    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-semibold text-gray-900">Manage Users</h1>
        <p class="text-gray-500 mt-1">View and manage user accounts</p>
    </div>

    <!-- Search & Filters -->
    <form method="get" class="flex flex-wrap gap-4 mb-6 items-end">
        <div class="flex-1 min-w-[200px]">
            <input type="text" name="searchString" value="@ViewBag.SearchString"
                   class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                   placeholder="Search users...">
        </div>
        <div class="w-48">
            <select name="roleFilter" onchange="this.form.submit()"
                    class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <option value="">All Roles</option>
                @foreach (var role in ViewBag.AvailableRoles)
                {
                    <option value="@role" selected="@(ViewBag.RoleFilter == role)">@role</option>
                }
            </select>
        </div>
        <div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2">
                <i class="bi bi-search"></i> Search
            </button>
        </div>
        <div class="ml-auto">
            <a href="javascript:void(0)" onclick="clearFilters()"
               class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-100 flex items-center gap-2">
                <i class="bi bi-x-circle"></i> Clear Filters
            </a>
        </div>
    </form>

    <!-- Users Table -->
    <div class="bg-white shadow-md rounded-xl overflow-x-auto">
        @if (Model.Any())
        {
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase">User</th>
                        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase">Email</th>
                        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase">Role</th>
                        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase">Status</th>
                        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase">Last Login</th>
                        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase">Created</th>
                        <th class="px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    @foreach (var user in Model)
                    {
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 flex items-center gap-3">
                                <i class="bi bi-person-circle text-2xl text-gray-400"></i>
                                <div>
                                    <div class="font-medium text-gray-900">@user.FullName</div>
                                    <div class="text-gray-500 text-sm">@user.UserName</div>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-gray-900">@user.Email</td>
                            <td class="px-6 py-4">
                                <span class="@user.RoleBadgeClass px-3 py-1 rounded-full text-sm font-semibold">
                                    @user.Role
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                <span class="@user.StatusBadgeClass px-3 py-1 rounded-full text-sm font-semibold">
                                    @user.StatusText
                                </span>
                            </td>
                            <td class="px-6 py-4 text-gray-500 text-sm">@user.FormattedLastLogin</td>
                            <td class="px-6 py-4 text-gray-500 text-sm">@user.FormattedCreatedDate</td>
                            <td class="px-6 py-4 flex gap-2">
                                <button class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-sm flex items-center gap-1" onclick="editUser('@user.Id')">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="bg-red-100 text-red-700 px-3 py-1 rounded-lg text-sm flex items-center gap-1" onclick="deleteUser('@user.Id', '@user.UserName')">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <!-- Pagination -->
            @if (ViewBag.TotalPages > 1)
            {
                <nav class="flex justify-center mt-4">
                    <ul class="inline-flex -space-x-px">
                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                        {
                            <li>
                                <a class="px-3 py-1 border rounded-l-lg border-gray-300 @(i == ViewBag.CurrentPage ? "bg-blue-600 text-white" : "bg-white text-gray-700 hover:bg-gray-100")"
                                   href="@Url.Action("ManageUsers", new { searchString = ViewBag.SearchString, roleFilter = ViewBag.RoleFilter, page = i, pageSize = ViewBag.PageSize })">
                                    @i
                                </a>
                            </li>
                        }
                    </ul>
                </nav>
            }

            <div class="text-gray-500 text-center mt-3">
                Showing @((ViewBag.CurrentPage - 1) * ViewBag.PageSize + 1) to
                @Math.Min(ViewBag.CurrentPage * ViewBag.PageSize, ViewBag.TotalUsers)
                of @ViewBag.TotalUsers users
            </div>
        }
        else
        {
            <div class="py-12 text-center text-gray-500">
                <i class="bi bi-people text-6xl mb-4"></i>
                <h4 class="text-xl font-semibold">No users found</h4>
                <p class="mt-2">
                    @if (!string.IsNullOrEmpty(ViewBag.SearchString) || !string.IsNullOrEmpty(ViewBag.RoleFilter))
                    {
                        <span>No users match your search criteria.</span>
                    }
                    else
                    {
                        <span>No users found in the system.</span>
                    }
                </p>
                @if (!string.IsNullOrEmpty(ViewBag.SearchString) || !string.IsNullOrEmpty(ViewBag.RoleFilter))
                {
                    <a href="@Url.Action("ManageUsers")" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="bi bi-arrow-left"></i> View All Users
                    </a>
                }
            </div>
        }
    </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-xl">
            <div class="modal-header border-b px-6 py-4">
                <h5 class="text-lg font-semibold">Edit User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body px-6 py-4">
                <form id="editUserForm" class="space-y-4">
                    <input type="hidden" id="editUserId" name="Id">

                    <div>
                        <label class="block font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="editUserName" class="w-full border border-gray-300 rounded-lg p-2" readonly>
                    </div>

                    <div>
                        <label class="block font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" id="editUserEmail" name="Email" class="w-full border border-gray-300 rounded-lg p-2" required>
                    </div>

                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label class="block font-medium text-gray-700 mb-1">First Name</label>
                            <input type="text" id="editUserFirstName" name="FirstName" class="w-full border border-gray-300 rounded-lg p-2">
                        </div>
                        <div class="flex-1">
                            <label class="block font-medium text-gray-700 mb-1">Last Name</label>
                            <input type="text" id="editUserLastName" name="LastName" class="w-full border border-gray-300 rounded-lg p-2">
                        </div>
                    </div>

                    <div>
                        <label class="block font-medium text-gray-700 mb-1">Role *</label>
                        <select id="editUserRole" name="Role" class="w-full border border-gray-300 rounded-lg p-2" required>
                            <option value="">Select Role</option>
                        </select>
                    </div>

                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="editUserIsActive" name="IsActive" class="h-4 w-4">
                        <label for="editUserIsActive" class="font-medium text-gray-700">Active User</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer px-6 py-4 border-t flex justify-end gap-2">
                <button type="button" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" onclick="saveUser()">Save Changes</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function clearFilters() {
            window.location.href = '@Url.Action("ManageUsers")';
        }

        // editUser, saveUser, deleteUser remain the same as your original JS
    </script>
}